Intel(R) Software Guard Extensions Data Center Attestation Primitives (Intel(R) SGX DCAP) Quote Generation Library Quick Start Guide
================================================

For Windows* OS
----------------- 
## Prerequisites
- Ensure that you have the following required operating systems:
   * Windows* Server 2016 (Long-Term Servicing Channel)
   * Windows* Server 2019 (Long-Term Servicing Channel)
- Ensure that you have the following required hardware:
  * 8th Generation Intel(R) Core(TM) Processor or newer with **Flexible Launch Control** support*
  * Intel(R) Atom(TM) Processor with **Flexible Launch Control** support*
- Configure the system with the **SGX hardware enabled** option.
- Ensure that you have installed Microsoft Visual C++ Compiler* version 14.14 or higher provided by Microsoft Visual Studio* 2017 versionÂ 15.7
- Ensure that you have installed latest Intel(R) SGX SDK Installer which could be downloaded from the [Intel(R) SGX SDK](https://software.intel.com/en-us/sgx-sdk/download)
- Use the script to download prebuilt binaries to prebuilt folder:
```
    download_prebuilt.bat
```

## How to build
- Open the Microsoft Visual Studio* solution and run a build.
- The Intel(R) SGX DCAP NuGet* package generation depends on a standalone tool `nuget.exe`. To build the Intel(R) SGX DCAP NuGet* package:
   1.  Download the standalone tool `nuget.exe` from [nuget.org/downloads](https://nuget.org/downloads) and put it to `installer\win\` folder or add the folder where you placed `nuget.exe` to your PATH environment variable. 
   2.  Go to `installer\win\` folder and enter the following command:
```
    DCAP_Components.bat
```
   The target NuGet* package `DCAP_Components.<version>.nupkg` will be generated in the same folder.
- To build the Intel(R) SGX DCAP INF installers, go to `installer\win\Dcap\` folder and enter the following commands:
```
    dcap_copy_file.bat
    dcap_generate.bat <version>
```
  The target INF installers `sgx_dcap.inf` and `sgx_dcap_dev.inf` will be generated in the same folder. 
**NOTE**:`sgx_dcap_dev.inf` is for Windows* Server 2016 LTSC and `sgx_dcap.inf` is for Windows* Server 2019 LTSC.

## How to install
   Refer to the *"Installation Instructions"* section in the [Intel(R) Software Guard Extensions: Data Center Attestation Primitives Installation Guide For Windows* OS](TODO-ref-link) to install the right packages on your platform.


For Linux* OS
-----------------
## Prerequisites
- Ensure that you have the following required operating systems:
  * Ubuntu* 16.04 LTS Desktop 64bits - minimal kernel 4.10
  * Ubuntu* 16.04 LTS Server 64bits - minimal kernel 4.10
  * Ubuntu* 18.04 LTS Desktop 64bits
  * Ubuntu* 18.04 LTS Server 64bits
- Ensure that you have the following required hardware:
  * 8th Generation Intel(R) Core(TM) Processor or newer with **Flexible Launch Control** support*
  * Intel(R) Atom(TM) Processor with **Flexible Launch Control** support*
- Configure the system with the **SGX hardware enabled** option.
- Use the following command(s) to install the required tools to build the Intel(R) SGX software:
```
  $ sudo apt-get install build-essential wget python debhelper
```
- Install latest prebuilt Intel(R) SGX SDK Installer from [01.org](https://01.org/intel-software-guard-extensions/downloads)
```
  $ ./sgx_linux_x64_sdk_${version}.bin
```
  In case you want to build Intel(R) SGX Installer, follow the instructions to build a compatible SDK and PSW on master branch of GitHub [Intel SGX for Linux*](https://github.com/intel/linux-sgx).
- Use the script ``download_prebuilt.sh`` inside source code package to download prebuilt binaries to prebuilt folder
  You may need set an https proxy for the `wget` tool used by the script (such as ``export https_proxy=http://test-proxy:test-port``)
```
  $ ./download_prebuilt.sh
```

## Build and Install Intel(R) SGX Driver
A `README.md` is provided in the Intel(R) SGX driver package for Intel(R) SGX DCAP. Please follow the instructions in the `README.md` to build and install Intel(R) SGX driver.


## Build the Intel(R) SGX DCAP Quote Generation Library Package
- To set the environment variables, enter the following command:
```
  $ source ${SGX_PACKAGES_PATH}/sgxsdk/environment
```
- To build the Intel(R) SGX DCAP Quote Generation Library package, enter the following command:
```
   $ make
``` 
The target package named ``linux_dcap_interface.zip`` will be generated.
- To clean the files generated by previous `make` command, enter the following command:
```
  $ make clean
```
- To rebuild the Intel(R) SGX DCAP Quote Generation Library package, enter the following command:
```
  $ make rebuild
```
- To build debug libraries, enter the following command:
```
  $ make DEBUG=1
```
- To build the Intel(R) SGX DCAP Quote Generation Library installers, enter the following commands:
```
  $ make deb_pkg
```
The installers will be generated in ./linux/installer/deb/.


## Install the Intel(R) SGX DCAP Quote Generation Library Package
- Install prebuilt Intel(R) SGX common loader Installer from [01.org](https://01.org/intel-software-guard-extensions/downloads)
```
  & sudo dpkg -i libsgx-enclave-common_{version}-{revision}_{arch}.deb
```
- For production systems, package should be installed by the following commands:
```
  $ sudo dpkg -i libsgx-dcap-ql_${version}-${revision}_${arch}.deb
```
- For development systems, two packages(including the above package) should be installed by the following commands:
```
  $ sudo dpkg -i libsgx-dcap-ql-dev_${version}-${revision}_${arch}.deb
  $ sudo dpkg -i libsgx-dcap-ql-dbg_${version}-${revision}_${arch}.deb
```
